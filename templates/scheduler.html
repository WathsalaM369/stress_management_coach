<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Task Scheduler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
        }

        .setup-section, .schedule-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .routine-setup {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .day-routine {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e7ff;
        }

        .day-routine h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .time-slot {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .time-slot input[type="time"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .time-slot select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .add-slot-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .add-slot-btn:hover {
            background: #5568d3;
        }

        .task-input-section {
            background: #f0f4ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .task-form {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .task-form input, .task-form select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .task-form input:focus, .task-form select:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-task-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .add-task-btn:hover {
            background: #059669;
        }

        .tasks-list {
            margin-top: 20px;
        }

        .task-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
        }

        .task-item.high {
            border-left-color: #ef4444;
        }

        .task-item.medium {
            border-left-color: #f59e0b;
        }

        .task-item.low {
            border-left-color: #10b981;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .task-details {
            font-size: 14px;
            color: #666;
        }

        .remove-task {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: block;
            margin: 30px auto;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .day-column {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 15px;
            min-height: 500px;
        }

        .day-header {
            font-weight: bold;
            color: #667eea;
            padding: 10px;
            background: white;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
        }

        .schedule-slot {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            font-size: 13px;
            position: relative;
        }

        .schedule-slot.work {
            border-left-color: #3b82f6;
        }

        .schedule-slot.break {
            border-left-color: #10b981;
        }

        .schedule-slot.hobby {
            border-left-color: #f59e0b;
        }

        .schedule-slot.personal {
            border-left-color: #8b5cf6;
        }

        .slot-time {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .slot-task {
            color: #666;
            margin-bottom: 5px;
        }

        .slot-controls {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .slot-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .slot-btn.danger {
            background: #ef4444;
        }

        .slot-btn.success {
            background: #10b981;
        }

        .warnings-section {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .warnings-section h3 {
            color: #d97706;
            margin-bottom: 10px;
        }

        .warning-item {
            padding: 8px;
            margin: 5px 0;
            color: #92400e;
        }

        .suggestions-section {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .suggestions-section h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #667eea;
        }

        .mood-stress-input {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        .input-group {
            flex: 1;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group select, .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .workload-analysis {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .workload-day {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .workload-day.light {
            background: #d1fae5;
            color: #065f46;
        }

        .workload-day.balanced {
            background: #dbeafe;
            color: #1e40af;
        }

        .workload-day.heavy {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóìÔ∏è Adaptive Task Scheduler</h1>

        <!-- Step 1: Weekly Routine Setup -->
        <div class="setup-section" id="routineSection">
            <div class="section-title">Step 1: Set Your Weekly Routine</div>
            <div class="routine-setup" id="routineSetup">
                <!-- Days will be added dynamically -->
            </div>
            <button class="generate-btn" onclick="saveRoutine()">Save Routine & Continue</button>
        </div>

        <!-- Step 2: Task Input -->
        <div class="setup-section" id="taskSection" style="display: none;">
            <div class="section-title">Step 2: Add Tasks to Schedule</div>
            
            <div class="mood-stress-input">
                <div class="input-group">
                    <label for="stressLevel">Current Stress Level (1-10)</label>
                    <input type="range" id="stressLevel" min="1" max="10" value="5" oninput="document.getElementById('stressValue').textContent = this.value">
                    <span id="stressValue">5</span>
                </div>
                <div class="input-group">
                    <label for="mood">Current Mood</label>
                    <select id="mood">
                        <option value="energetic">Energetic</option>
                        <option value="focused">Focused</option>
                        <option value="neutral">Neutral</option>
                        <option value="tired">Tired</option>
                        <option value="stressed">Stressed</option>
                        <option value="scattered">Scattered</option>
                    </select>
                </div>
            </div>

            <div class="task-input-section">
                <div class="task-form">
                    <input type="text" id="taskName" placeholder="Task Name" required>
                    <input type="number" id="taskDuration" placeholder="Duration (hours)" min="0.5" step="0.5" required>
                    <select id="taskPriority">
                        <option value="high">High Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                    <input type="date" id="taskDeadline" placeholder="Deadline">
                </div>
                <button class="add-task-btn" onclick="addTask()">‚ûï Add Task</button>
                <div class="tasks-list" id="tasksList"></div>
            </div>
            
            <button class="generate-btn" onclick="generateSchedule()">üöÄ Generate Smart Schedule</button>
        </div>

        <!-- Step 3: Generated Schedule -->
        <div class="schedule-section" id="scheduleSection" style="display: none;">
            <div class="section-title">Your Optimized Schedule</div>
            
            <div id="warningsContainer"></div>
            <div id="suggestionsContainer"></div>
            <div id="workloadContainer"></div>
            
            <div class="calendar-view" id="calendarView"></div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            Generating your personalized schedule... ü§ñ
        </div>
    </div>

    <script>
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        let tasks = [];
        let weeklyRoutine = {};

        // Initialize routine setup
        function initRoutineSetup() {
            const container = document.getElementById('routineSetup');
            days.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-routine';
                dayDiv.innerHTML = `
                    <h3>${day}</h3>
                    <div id="${day}-slots">
                        <div class="time-slot">
                            <input type="time" value="09:00">
                            <span>-</span>
                            <input type="time" value="17:00">
                            <select>
                                <option value="work">Work</option>
                                <option value="hobby">Hobby</option>
                                <option value="leisure">Leisure</option>
                                <option value="exercise">Exercise</option>
                                <option value="sleep">Sleep</option>
                                <option value="blocked">Blocked/Unavailable</option>
                            </select>
                        </div>
                    </div>
                    <button class="add-slot-btn" onclick="addTimeSlot('${day}')">+ Add Slot</button>
                `;
                container.appendChild(dayDiv);
            });
        }

        function addTimeSlot(day) {
            const slotsDiv = document.getElementById(`${day}-slots`);
            const slotDiv = document.createElement('div');
            slotDiv.className = 'time-slot';
            slotDiv.innerHTML = `
                <input type="time" value="09:00">
                <span>-</span>
                <input type="time" value="17:00">
                <select>
                    <option value="work">Work</option>
                    <option value="hobby">Hobby</option>
                    <option value="leisure">Leisure</option>
                    <option value="exercise">Exercise</option>
                    <option value="sleep">Sleep</option>
                    <option value="blocked">Blocked/Unavailable</option>
                </select>
            `;
            slotsDiv.appendChild(slotDiv);
        }

        function saveRoutine() {
            weeklyRoutine = {};
            days.forEach(day => {
                const slots = document.querySelectorAll(`#${day}-slots .time-slot`);
                weeklyRoutine[day] = [];
                slots.forEach(slot => {
                    const inputs = slot.querySelectorAll('input[type="time"]');
                    const select = slot.querySelector('select');
                    weeklyRoutine[day].push({
                        start: inputs[0].value,
                        end: inputs[1].value,
                        type: select.value
                    });
                });
            });

            // Send to backend
            fetch('/api/save-routine', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ routine: weeklyRoutine })
            });

            // Show task section
            document.getElementById('routineSection').style.display = 'none';
            document.getElementById('taskSection').style.display = 'block';
        }

        function addTask() {
            const name = document.getElementById('taskName').value;
            const duration = document.getElementById('taskDuration').value;
            const priority = document.getElementById('taskPriority').value;
            const deadline = document.getElementById('taskDeadline').value;

            if (!name || !duration) {
                alert('Please fill in task name and duration');
                return;
            }

            const task = {
                id: Date.now(),
                name,
                duration: parseFloat(duration),
                priority,
                deadline: deadline || null
            };

            tasks.push(task);
            displayTasks();

            // Clear inputs
            document.getElementById('taskName').value = '';
            document.getElementById('taskDuration').value = '';
            document.getElementById('taskDeadline').value = '';
        }

        function displayTasks() {
            const container = document.getElementById('tasksList');
            container.innerHTML = tasks.map(task => `
                <div class="task-item ${task.priority}">
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-details">
                            ${task.duration} hours ‚Ä¢ ${task.priority} priority
                            ${task.deadline ? ` ‚Ä¢ Due: ${task.deadline}` : ''}
                        </div>
                    </div>
                    <button class="remove-task" onclick="removeTask(${task.id})">Remove</button>
                </div>
            `).join('');
        }

        function removeTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            displayTasks();
        }

        async function generateSchedule() {
            if (tasks.length === 0) {
                alert('Please add at least one task');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('taskSection').style.display = 'none';

            const stressLevel = document.getElementById('stressLevel').value;
            const mood = document.getElementById('mood').value;
            const today = new Date();
            const weekStart = new Date(today.setDate(today.getDate() - today.getDay() + 1));

            try {
                const response = await fetch('/api/generate-schedule', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tasks,
                        week_start: weekStart.toISOString().split('T')[0],
                        stress_level: parseInt(stressLevel),
                        mood
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    displaySchedule(data.schedule);
                } else {
                    alert('Error generating schedule: ' + data.message);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displaySchedule(scheduleData) {
            document.getElementById('scheduleSection').style.display = 'block';

            // Display warnings
            if (scheduleData.warnings && scheduleData.warnings.length > 0) {
                const warningsHtml = `
                    <div class="warnings-section">
                        <h3>‚ö†Ô∏è Scheduling Warnings</h3>
                        ${scheduleData.warnings.map(w => `<div class="warning-item">‚Ä¢ ${w}</div>`).join('')}
                    </div>
                `;
                document.getElementById('warningsContainer').innerHTML = warningsHtml;
            }

            // Display suggestions
            if (scheduleData.suggestions && scheduleData.suggestions.length > 0) {
                const suggestionsHtml = `
                    <div class="suggestions-section">
                        <h3>üí° Optimization Suggestions</h3>
                        ${scheduleData.suggestions.map(s => `<div class="warning-item">‚Ä¢ ${s}</div>`).join('')}
                    </div>
                `;
                document.getElementById('suggestionsContainer').innerHTML = suggestionsHtml;
            }

            // Display workload analysis
            if (scheduleData.workload_analysis) {
                const workloadHtml = `
                    <div class="workload-analysis">
                        ${Object.entries(scheduleData.workload_analysis).map(([day, load]) => `
                            <div class="workload-day ${load}">${day}: ${load}</div>
                        `).join('')}
                    </div>
                `;
                document.getElementById('workloadContainer').innerHTML = workloadHtml;
            }

            // Display calendar
            const calendar = document.getElementById('calendarView');
            calendar.innerHTML = scheduleData.schedule.map(day => `
                <div class="day-column">
                    <div class="day-header">
                        <div>${day.day}</div>
                        <div style="font-size: 12px; font-weight: normal;">${day.date}</div>
                    </div>
                    ${day.slots.map((slot, idx) => `
                        <div class="schedule-slot ${slot.type}" data-day="${day.day}" data-slot="${idx}">
                            <div class="slot-time">${slot.time}</div>
                            <div class="slot-task">${slot.task}</div>
                            <div style="font-size: 11px; color: #888;">${slot.priority} priority</div>
                            ${slot.notes ? `<div style="font-size: 11px; color: #666; margin-top: 5px;">üí≠ ${slot.notes}</div>` : ''}
                            ${slot.flexible ? `
                                <div class="slot-controls">
                                    <button class="slot-btn success" onclick="adjustTime('${day.day}', ${idx}, 'add')">+30min</button>
                                    <button class="slot-btn danger" onclick="adjustTime('${day.day}', ${idx}, 'reduce')">-30min</button>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        async function adjustTime(day, slotIdx, adjustment) {
            const response = await fetch('/api/adjust-task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    day,
                    task_id: slotIdx,
                    adjustment: adjustment === 'add' ? 'add_30min' : 'reduce_30min'
                })
            });

            const data = await response.json();
            if (data.status === 'success') {
                displaySchedule(data.schedule);
            } else {
                alert('Could not adjust task: ' + data.message);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initRoutineSetup);
    </script>
</body>
</html>